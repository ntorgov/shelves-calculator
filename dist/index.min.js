"use strict";var Color=THREE.Color,BufferGeometry=THREE.BufferGeometry,camera,scene,renderer,geometry,material,BoxSeries;(function(a){a[a.sk=0]="sk",a[a.ls=1]="ls"})(BoxSeries||(BoxSeries={}));var BoxColor;(function(a){a[a.blue=0]="blue",a[a.red=1]="red",a[a.yellow=2]="yellow"})(BoxColor||(BoxColor={}));var light;calculatorApplication.controller("calculatorController",function(a,b){function c(){var o,p,q,r,s,t,u,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y=[];if(a.isVisualizating=!0,a.cupboard.width&&a.cupboard.width.value){for(U=new THREE.MeshStandardMaterial({color:7829367,wireframe:!1,reflectivity:0}),V=new THREE.Shape,V.moveTo(0,0),V.lineTo(0,30*f),V.lineTo(1*f,30*f),V.lineTo(1*f,1*f),V.lineTo(30*f,1*f),V.lineTo(30*f,0),V.lineTo(0,0),W={steps:2,amount:a.cupboard.height.value*f,bevelEnabled:!1},X=new THREE.ExtrudeGeometry(V,W),K=1;4>=K;K++)M=scene.getObjectByName("shelveHolder"+K),M&&scene.remove(M);for(J=0;J<=a.shelvesCountOld;J++)M=scene.getObjectByName("shelve"+J),M&&scene.remove(M);for(L=0;L<=a.boxCounter;L++)M=scene.getObjectByName("box"+L),M&&scene.remove(M);if(Q=new ThreeBSP(X),500>=a.cupboard.height.value)for(R=new THREE.CylinderGeometry(h*f,h*f,70*f,4),T=new THREE.Mesh(R,U),T.position.x=16*f,S=0;S<a.cupboard.height.value/g;S++)T.position.z=(S*g+i/2)*f,r=new ThreeBSP(T),T.rotation.z=THREE.Math.degToRad(90),T.position.y=16*f,q=new ThreeBSP(T),Q=Q.subtract(r.union(q)),T.position.y=0,T.rotation.z=THREE.Math.degToRad(0),r=void 0,q=void 0;for(K=1;4>=K;K++)Y[K]=Q.toMesh(U),Y[K].geometry.computeVertexNormals(),Y[K].name="shelveHolder"+K,Y[K].castShadow=!0,Y[K].receiveShadow=!0,Y[K].rotation.x=THREE.Math.degToRad(-90);for(Q=void 0,Y[2].position.set((a.cupboard.width.value+2)*f,0,0),Y[2].rotation.z=THREE.Math.degToRad(90),Y[3].position.set((a.cupboard.width.value+2)*f,0,(-1*a.cupboard.deep.value-2)*f),Y[3].rotation.z=THREE.Math.degToRad(180),Y[4].position.set(0,0,(-1*a.cupboard.deep.value-2)*f),Y[4].rotation.z=THREE.Math.degToRad(270),light.position.y=3*((a.cupboard.width.value+a.cupboard.deep.value+a.cupboard.height.value)*f),light.position.x=3*((a.cupboard.width.value+a.cupboard.deep.value+a.cupboard.height.value)*f),light.position.z=3*((a.cupboard.width.value+a.cupboard.deep.value+a.cupboard.height.value)*f),K=1;4>=K;K++)scene.add(Y[K]);if(a.shelvesCountOld=a.shelvesCount,a.shelvesCount){if(a.boxCounter=0,G=(a.cupboard.width.value-58)/a.boxCount,E=(G-a.selectedBox.width)/2,F=a.selectedBox.width/2+30,console.log("\u0428\u0438\u0440\u0438\u043D\u0430 \u043F\u043E\u0441\u0430\u0434\u043E\u0447\u043D\u043E\u0433\u043E \u043C\u0435\u0441\u0442\u0430: "+G),O=new THREE.BoxGeometry(a.cupboard.width.value*f,i*f,a.cupboard.deep.value*f),H=new THREE.MeshStandardMaterial({color:1118719,wireframe:!1,transparent:!1,opacity:1}),I=new THREE.MeshStandardMaterial({color:10066431,wireframe:!1,transparent:!0,opacity:0.3}),D=new THREE.BoxGeometry(a.selectedBox.width*f,a.selectedBox.height*f,a.selectedBox.deep*f),C=new THREE.Mesh(D,H),B=new THREE.BoxGeometry((a.selectedBox.width-4)*f,a.selectedBox.height*f,(a.selectedBox.deep-4)*f),A=new THREE.Mesh(B,H),A.position.y=4*f,z=new ThreeBSP(C),y=new ThreeBSP(A),x=z.subtract(y),o=new THREE.Group,0===a.selectedBox.series){console.log("Box SK"),u=new THREE.BoxGeometry(0.7*a.selectedBox.width*f,0.66*a.selectedBox.height*f,0.3*a.selectedBox.deep*f),t=new THREE.Mesh(u,H),t.position.z=a.selectedBox.deep/2*f,t.position.y=(a.selectedBox.height/2-0.66*a.selectedBox.height/2)*f,s=new ThreeBSP(t),x=x.subtract(s);var Z=new THREE.BoxGeometry(0.7*a.selectedBox.width*f,0.66*a.selectedBox.height*f,f),$=new THREE.Mesh(Z,I);$.position.z=a.selectedBox.deep/2*f,$.position.y=(a.selectedBox.height/2-0.66*a.selectedBox.height/2)*f,o.add(x.toMesh(H)),o.add($)}else console.log("Box LS"),u=new THREE.BoxGeometry(a.selectedBox.width*f,0.66*a.selectedBox.height*f,0.66*a.selectedBox.deep*f),t=new THREE.Mesh(u,H),t.position.z=a.selectedBox.deep/2*f,t.position.y=(a.selectedBox.height/2-0.3*a.selectedBox.height/2)*f,t.rotation.x=THREE.Math.degToRad(45),s=new ThreeBSP(t),x=x.subtract(s),o.add(x.toMesh(H));for(J=0;J<=a.shelvesCount;J++)if(N=a.cupboard.height.value-J*a.shelveHeight-i/2,P=new THREE.Mesh(O,U),P.name="shelve"+J,P.castShadow=!0,P.receiveShadow=!0,P.position.set((0.5*a.cupboard.width.value+1)*f,N*f,(-0.5*a.cupboard.deep.value-1)*f),scene.add(P),0<J)for(p=[],L=0;L<a.boxCount;L++)p[L]=o.clone(),a.boxCounter++,w=N+i/2+a.selectedBox.height/2,p[L].name="box"+a.boxCounter,p[L].position.set((L*G+E+F)*f,w*f,(a.selectedBox.deep/-2-1)*f),scene.add(p[L])}camera.position.y=a.cupboard.height.value*f,a.cameraRadius=Math.sqrt(Math.pow(a.cupboard.height.value,2)+Math.pow(a.cupboard.width.value,2))*f,camera.position.x=2*(a.cameraRadius*Math.cos(a.angle))*f,camera.position.z=2*(a.cameraRadius*Math.sin(a.angle))*f,camera.lookAt(new THREE.Vector3(0.5*a.cupboard.width.value*f,0.5*a.cupboard.height.value*f,-0.5*a.cupboard.deep.value*f))}a.isVisualizating=!1}function d(){var o=2*a.cameraRadius,p;a.cupboard.width&&a.cupboard.width.value&&(renderer.render(scene,camera),camera.position.x=o*Math.cos(a.angle)+0.5*a.cupboard.width.value*f,camera.position.z=o*Math.sin(a.angle)+-0.5*a.cupboard.deep.value*f,a.angle+=2e-3,p=new THREE.Vector3(0.5*a.cupboard.width.value*f,0.5*a.cupboard.height.value*f,-0.5*a.cupboard.deep.value*f),camera.lookAt(p),requestAnimationFrame(d),a.isRendered=!0)}function e(){var o=4/3.8,p=document.getElementById("visualization").offsetWidth,q;scene=new THREE.Scene,camera=new THREE.PerspectiveCamera(40,o,1,5e3),camera.isPerspectiveCamera=!1,scene.add(new THREE.AmbientLight(16777215)),q=new THREE.HemisphereLight(14544639,986637,0.02),q.intensity=3.4,scene.add(q),light=new THREE.PointLight(16777215,1,100),light.castShadow=!1,light.shadowMapWidth=2048,light.shadowMapHeight=2048,light.power=180,scene.add(light),renderer=new THREE.WebGLRenderer({antialias:!0}),renderer.setSize(p,p/o),renderer.shadowMap.enabled=!0,renderer.toneMappingExposure=Math.pow(1.15,5),renderer.toneMapping=THREE.ReinhardToneMapping,renderer.physicallyCorrectLights=!0,renderer.gammaInput=!0,renderer.gammaOutput=!0,document.getElementById("visualization").appendChild(renderer.domElement)}var f=1/1e3,g=25,h=4,i=25;a.widths=[{value:700,title:700,deeps:[{value:300,title:300,price:303},{value:400,title:400,price:366},{value:500,title:500,price:432},{value:600,title:600,price:518},{value:700,title:700,price:700},{value:800,title:800,price:766}]},{value:1e3,title:1e3,deeps:[{value:300,title:300,price:383},{value:400,title:400,price:481},{value:500,title:500,price:554},{value:600,title:600,price:649},{value:700,title:700,price:808},{value:800,title:800,price:914}]},{value:1200,title:1200,deeps:[{value:300,title:300,price:533},{value:400,title:400,price:630},{value:500,title:500,price:773},{value:600,title:600,price:887}]},{value:1500,title:1500,deeps:[{value:300,title:300,price:702},{value:400,title:400,price:852},{value:500,title:500,price:1004},{value:600,title:600,price:1237}]}],a.heights=[{value:500,title:500,selected:!0,price:115,shelves:{min:3,max:5}},{value:1e3,title:1e3,selected:!1,price:188,shelves:{min:3,max:11}},{value:1200,title:1200,selected:!1,price:220,shelves:{min:3,max:13}},{value:1500,title:1500,selected:!1,price:268,shelves:{min:3,max:13}},{value:1800,title:1800,selected:!1,price:308,shelves:{min:3,max:13}},{value:2e3,title:2e3,selected:!1,price:336,shelves:{min:3,max:13}},{value:2200,title:2200,selected:!1,price:370,shelves:{min:3,max:13}},{value:2300,title:2300,selected:!1,price:390,shelves:{min:3,max:13}},{value:2500,title:2500,selected:!1,price:420,shelves:{min:3,max:13}}],a.drawHeight=400,a.boxes=[{id:"12.330.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 3109",price:91,width:117,height:90,deep:300,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/3109l3.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-3109/",color:0,series:0},{id:"12.331.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 31509",price:106,width:155,height:90,deep:300,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/31509dh.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-31509/",color:0,series:0},{id:"12.332.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 3209",price:140,width:234,height:90,deep:300,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/3209hj.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-3209/",color:0,series:0},{id:"12.333.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 3214",price:216,width:234,height:140,deep:300,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/32145i.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-3214/",color:0,series:0},{id:"12.334.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 4109",price:117,width:117,height:90,deep:400,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/4109kh.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-4109/",color:0,series:0},{id:"12.335.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 41509",price:143,width:155,height:90,deep:400,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/41509yk.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-41509/",color:0,series:0},{id:"12.336.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 4209",price:182,width:234,height:90,deep:400,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/42095y.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-4209/",color:0,series:0},{id:"12.337.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 4214",price:306,width:234,height:140,deep:400,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/4214vd.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-4214/",color:0,series:0},{id:"12.338.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 5109",price:132,width:117,height:90,deep:500,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/51092v.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-5109/",color:0,series:0},{id:"12.339.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 51509",price:162,width:155,height:90,deep:500,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/51509mi.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-51509/",color:0,series:0},{id:"12.340.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 5209",price:206,width:234,height:90,deep:500,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/5209gf.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-5209/",color:0,series:0},{id:"12.341.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 5214",price:315,width:234,height:140,deep:500,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/52144y.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-5214/",color:0,series:0},{id:"12.342.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 6109",price:165,width:117,height:90,deep:600,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/6109bi.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-6109/",color:0,series:0},{id:"12.343.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 61509",price:196,width:155,height:90,deep:600,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/61509ht.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-61509/",color:0,series:0},{id:"12.344.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 6209",price:255,width:234,height:90,deep:600,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/6209k3.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-6209/",color:0,series:0},{id:"12.345.65",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 sk 6214",price:397,width:234,height:140,deep:600,sort:1,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/6214at.jpg",url:"http://www.agropak.net/hgfhgf/kontejner-sk-6214/",color:0,series:0},{id:"12.412",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 12.412",price:110,width:225,height:150,deep:300,sort:2,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/12_412dq.jpg",url:"http://www.agropak.net/kontejnery-logic-store/12412/",color:0,series:1},{id:"12.403.1",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 12.403.1",price:125,width:225,height:150,deep:350,sort:2,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/n12-403mn.jpg",url:"http://www.agropak.net/kontejnery-logic-store/12_403/",color:0,series:1},{id:"12.404.1",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 12.404.1",price:147,width:225,height:200,deep:350,sort:2,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/n12-404wb.jpg",url:"http://www.agropak.net/kontejnery-logic-store/12_404/",color:0,series:1},{id:"12.414",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 12.414",price:151,width:225,height:150,deep:400,sort:2,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/12_414.jpg",url:"http://www.agropak.net/kontejnery-logic-store/12414/",color:0,series:1},{id:"12.405.1",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 12.405.1",price:180,width:225,height:150,deep:500,sort:2,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/n12-4050c.jpg",url:"http://www.agropak.net/kontejnery-logic-store/12_405/",color:0,series:1},{id:"12.406.1",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 12.406.1",price:270,width:300,height:200,deep:500,sort:2,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/n12-406b.jpg",url:"http://www.agropak.net/kontejnery-logic-store/12_406/",color:0,series:1},{id:"12.407.1",title:"\u041A\u043E\u043D\u0442\u0435\u0439\u043D\u0435\u0440 12.407.1",price:305,width:300,height:250,deep:500,sort:2,image:"http://www.agropak.net/published/publicdata/AGROPAK/attachments/SC/products_pictures/n12-407b.jpg",url:"http://www.agropak.net/kontejnery-logic-store/12_407/",color:0,series:1}],a.shelvesCount=0,a.shelvesCountOld=0,a.shelveHeight=0,a.boxCount=0,a.boxCounter=0,a.cameraRadius=0,a.angle=0,a.isVisualizating=!1,a.isCalculating=!1,a.isRendered=!1,a.oldHeight=0,a.oldWidth=0,a.oldDeep=0,a.init=function(){var o=document.getElementById("visualization");o&&e()},a.init(),a.Calculation=function(){var o,p,q,r,s=a.cupboard.height,t=a.cupboard.width,u=a.cupboard.deep;!1===a.isCalculating&&(a.oldHeight=s,a.oldWidth=t,a.oldDeep=u,a.isCalculating=!0,angular.isObject(a.selectedBox)&&(o=Math.floor(s.value/(a.selectedBox.height+30+35)),o+1<s.shelves.min&&(o=s.shelves.min),o+1>s.shelves.max&&(o=s.shelves.max),q=0,q=2<o?Math.floor(s.value/o/g)*g:Math.floor((a.selectedBox.height+30+35)/g)*g,145>q&&(q=145),o*q>=s.value&&o--,r=Math.floor((t.value-60)/a.selectedBox.width),a.shelvesCount=o,a.shelveHeight=q,a.boxCount=r,console.info("\u041F\u0440\u0435\u0434\u043F\u043E\u043B\u0430\u0433\u0430\u0435\u043C\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u043F\u043E\u043B\u043E\u043A: "+o),console.info("\u041F\u0440\u0435\u0434\u043F\u043E\u043B\u0430\u0433\u0430\u0435\u043C\u0430\u044F \u0432\u044B\u0441\u043E\u0442\u0430 \u043A\u043E\u043D\u0441\u0442\u0440\u0443\u043A\u0446\u0438\u0438: "+o*q),console.info("\u041F\u0440\u0435\u0434\u043F\u043E\u043B\u0430\u0433\u0430\u0435\u043C\u043E\u0435 \u0432\u044B\u0441\u043E\u0442\u0430 \u043F\u043E\u043B\u043E\u043A: "+q),console.info("\u041F\u0440\u0435\u0434\u043F\u043E\u043B\u0430\u0433\u0430\u0435\u043C\u043E\u0435 \u043A\u043E\u043B\u0438\u0447\u0435\u0441\u0442\u0432\u043E \u044F\u0449\u0438\u043A\u043E\u0432: "+r)),!1===a.isVisualizating&&(c(),!1===a.isRendered&&d()),angular.isObject(u)&&(p=b("filter")(a.boxes,{deep:u.value},function(v,w){var x=!1;return(v===w-50||v===w)&&(x=!0),x}),a.boxResult=b("orderBy")(p,["-deep","+sort"]),console.log(a.boxResult)),a.isCalculating=!1)},a.BoxClick=function(p){a.selectedBox=p,a.boxPrice=a.boxCount*a.shelvesCount*p.price,a.totalPrice+=a.boxPrice,this.Calculation()},a.ChangeDeep=function(){a.cupboard.deep!==a.oldDeep&&(a.selectedBox=void 0,this.Calculation())},a.ChangeWidth=function(){a.deeps=a.cupboard.width.deeps,a.cupboard.deep=a.deeps[0],a.cupboard.width!==a.oldWeight&&this.Calculation()},a.ChangeHeight=function(){var p,q=[],r=[];for(angular.forEach(a.heights,function(s){s.value===a.cupboard.height&&this.push(s.shelves)},r),p=a.cupboard.height.shelves.min;p<=a.cupboard.height.shelves.max;p++)q.push({value:p,title:p});a.shelves=q,a.cupboard.shelve=a.shelves[0],a.cupboard.height!==a.oldHeight&&this.Calculation()}});
